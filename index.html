<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Math Reveal â€¢ Tap to Start</title>

  <style>
    :root{ --text:#111; }
    *{ box-sizing:border-box; font-family:system-ui, Arial, sans-serif; }
    body{ margin:0; background:#fff; color:var(--text); }

    .screen{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:20px;
      padding:24px;
      cursor:pointer;
      user-select:none;
      text-align:center;
    }

    .logo{
      width:min(520px, 85vw);
      height:auto;
      display:block;
      pointer-events:none;
      user-select:none;
    }

    .tapText{
      font-size:17px;
      opacity:.85;
      letter-spacing:.2px;
      animation: blink 1.2s ease-in-out infinite;
    }

    @keyframes blink{
      0%,100%{ opacity:1; }
      50%{ opacity:.2; }
    }
  </style>
</head>
<body>

  <main class="screen" id="tapArea" aria-label="Tap to start">
    <img
      src="assets/img/logomathreveal.png"
      alt="Math Reveal"
      class="logo"
      draggable="false"
    />
    <div class="tapText">Ketuk layar di mana saja untuk memulai</div>
  </main>

  <audio id="bgm" loop preload="auto">
    <source src="assets/audio/mathreveal.mp3" type="audio/mpeg">
  </audio>

  <script>
    const tapArea = document.getElementById("tapArea");
    const bgm = document.getElementById("bgm");
    let started = false;

    function persistTime(){
      try{ sessionStorage.setItem("bgmTime", String(bgm.currentTime || 0)); }catch(_){}
    }

    function goMenu(){
      persistTime();
      window.location.href = "menu.html";
    }

    async function startGame(){
      if (started) return;
      started = true;

      // flag supaya halaman lain auto-play
      localStorage.setItem("bgmUnlocked", "1");

      // play musik (harus setelah gesture)
      bgm.volume = 0.4;
      try{ await bgm.play(); }catch(_){}

      // simpan posisi beberapa kali biar aman
      persistTime();
      setTimeout(persistTime, 50);

      // pindah ke menu
      setTimeout(goMenu, 150);
    }

    tapArea.addEventListener("click", startGame, { passive:true });
    tapArea.addEventListener("touchstart", startGame, { passive:true });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") startGame();
    });

    // kalau tiba-tiba pindah tab / reload
    window.addEventListener("pagehide", persistTime);
  </script>
</body>
</html>

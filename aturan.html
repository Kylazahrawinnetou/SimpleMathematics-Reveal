<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Memuat</title>

  <style>
    :root{
      /* =========================
         üé® GANTI WARNA DI SINI
         ========================= */

      /* Background halaman */
      --bgImage:url("assets/img/bgmathreveal.png");

      /* WARNA TEKS */
      --text:#111;                 /* warna teks utama (judul, tombol) */
      --textMuted:rgba(0,0,0,.68); /* warna teks deskripsi aturan */

      /* WARNA PANEL (box aturan & loading) */
      --panelBase:#d6d6d6;         /* warna dasar panel */

      /* WARNA BORDER / OUTLINE */
      --stroke:#444;               /* outline normal */
      --strokeHover:#222;          /* outline hover */

      /* TOMBOL */
      --btnBase:#d6d6d6;           /* background tombol normal */
      --btnHover:#ffffff;          /* background tombol hover */
      --btnActive:#bfbfbf;         /* background tombol ditekan */

      /* Radius / ukuran */
      --roundBig:28px;
      --round:22px;
      --w:980px;

      /* Bayangan tombol */
      --shadowStrong:0 12px 0 rgba(0,0,0,.35);
      --shadowSoft:0 8px 18px rgba(0,0,0,.18);
    }

    *{ box-sizing:border-box; font-family:system-ui,Arial,sans-serif; }
    html, body{ height:100%; }

    body{
      margin:0;
      color:var(--text);
      background: var(--bgImage) center / cover no-repeat;
      background-attachment: fixed;
    }

    .page{ max-width:var(--w); margin:0 auto; padding:26px; }

    .stack{
      min-height:calc(100vh - 52px);
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:22px;
      align-items:center;
    }

    /* =========================
       üß± BOX ATURAN (POLOS)
       ========================= */
    .ruleCard{
      width:min(900px, 92vw);
      height:340px;
      border:2px solid var(--stroke);
      border-radius:var(--roundBig);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:30px;
      text-align:center;

      background: linear-gradient(180deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.04)), var(--panelBase);
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
    }

    .ruleTitle{
      font-size:30px;
      font-weight:900;
      margin:0 0 14px;
      letter-spacing:.2px;
      color:var(--text); /* ‚úÖ ganti via --text */
    }

    .ruleText{
      margin:0;
      max-width:760px;
      color:var(--textMuted); /* ‚úÖ ganti via --textMuted */
      font-weight:700;
      line-height:1.75;
      font-size:16px;
    }
    .ruleText .line{ display:block; margin:4px 0; }

    /* =========================
       ‚è≥ LOADING CARD (POLOS)
       ========================= */
    .loadingCard{
      width:min(900px, 92vw);
      height:120px;
      border:2px solid var(--stroke);
      border-radius:var(--roundBig);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px 24px;
      gap:14px;
      flex-direction:column;

      background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(0,0,0,.04)), var(--panelBase);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }

    .barShell{
      width:min(760px, 100%);
      height:24px;
      border:2px solid var(--stroke);
      border-radius:999px;
      overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.18));
      box-shadow: inset 0 2px 0 rgba(255,255,255,.55), inset 0 -2px 0 rgba(0,0,0,.08);
      position:relative;
    }

    .barFill{
  height:100%;
  width:0%;
  border-radius:999px;

  /* =========================
     üé® WARNA LOADING (HITAM)
     ========================= */
  background:#111;

  /* depth / efek timbul */
  box-shadow:
    inset 0 2px 0 rgba(255,255,255,.25),
    0 6px 14px rgba(0,0,0,.2);

  transition:width .14s linear;

  position:relative;
  overflow:hidden;

  /* animasi lembut */
  animation: barPulse 1.2s ease-in-out infinite;
}

/* kilau berjalan */
.barFill::after{
  content:"";
  position:absolute;
  top:0;
  left:-40%;
  width:40%;
  height:100%;
  background:linear-gradient(
    90deg,
    rgba(255,255,255,0),
    rgba(255,255,255,.45),
    rgba(255,255,255,0)
  );
  animation: barShine 1.1s linear infinite;
  pointer-events:none;
  opacity:.9;
}

/* =========================
   üéûÔ∏è ANIMASI
   ========================= */
@keyframes barShine{
  to{ left:110%; }
}

@keyframes barPulse{
  0%,100%{ filter:brightness(1); }
  50%{ filter:brightness(1.15); }
}


    .btnRow{
      width:min(900px, 92vw);
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-top:2px;
    }

    /* =========================
       üîò TOMBOL (NGANGKAT ‚Üí PRESS)
       ========================= */
    .btn{
      min-width:180px;
      padding:12px 16px;
      font-weight:900;
      text-align:center;
      user-select:none;
      cursor:pointer;

      color:var(--text);              /* ‚úÖ warna teks tombol: --text */
      border:5px solid var(--stroke); /* ‚úÖ outline tebal */
      border-radius:var(--round);

      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(0,0,0,.03)), var(--btnBase);

      box-shadow: var(--shadowStrong), var(--shadowSoft);
      transform: translateY(0);
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease, filter .12s ease;
    }

    .btn:hover{
      border-color:var(--strokeHover);
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(0,0,0,.03)), var(--btnHover);
      filter:brightness(1.02);
      transform: translateY(-2px); /* ngangkat dikit */
    }

    .btn:active{
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.06)), var(--btnActive);
      transform: translateY(8px); /* ditekan */
      box-shadow: 0 4px 0 rgba(0,0,0,.35), 0 4px 10px rgba(0,0,0,.12);
      filter:brightness(.98);
    }

    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow: 0 6px 0 rgba(0,0,0,.22);
      filter:saturate(.9);
    }
  </style>
</head>

<body>
  <main class="page">
    <section class="stack">

      <div class="ruleCard">
        <div>
          <h1 class="ruleTitle">Aturan Game</h1>

          <p class="ruleText">
            <span class="line">Jawab soal pakai keypad (maksimal 3 digit).</span>
            <span class="line">Jika salah 3 kali, tombol Hint akan aktif.</span>
            <span class="line">Setiap jawaban benar akan membuka 1 tile.</span>
            <span class="line">Fase 1 (2√ó2) : timer 20 detik.</span>
            <span class="line">Fase 2 (3√ó3) : timer 15 detik.</span>
            <span class="line">Fase 3 (4√ó4) : timer 10 detik.</span>
            <span class="line">Jika tidak ada interaksi/timer habis, anda akan ditampilkan popup keluar.</span>
          </p>
        </div>
      </div>

      <div class="loadingCard">
        <div class="barShell" aria-label="Loading progress">
          <div id="barFill" class="barFill"></div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn" id="btnBack" type="button">Kembali</button>
        <button class="btn" id="btnContinue" type="button" disabled>Lanjutkan</button>
      </div>

    </section>
  </main>

  <!-- üéµ BGM -->
  <audio id="bgm" loop preload="auto">
    <source src="assets/audio/mathreveal.mp3" type="audio/mpeg">
  </audio>

  <script>
    const DURATION_SEC = 20;
    const NEXT_PAGE = "HalLevel.html";
    const BACK_PAGE = "menu.html";

    const barFill = document.getElementById("barFill");
    const btnBack = document.getElementById("btnBack");
    const btnContinue = document.getElementById("btnContinue");

    const bgm = document.getElementById("bgm");

    let tickId = null;
    let finished = false;

    function persistTime(){
      try{ sessionStorage.setItem("bgmTime", String(bgm.currentTime || 0)); }catch(_){}
    }

    function resumeBgmSoft(){
      if (localStorage.getItem("bgmUnlocked") !== "1") return;

      const t = Number(sessionStorage.getItem("bgmTime") || "0");
      if (Number.isFinite(t) && t > 0){
        try{ bgm.currentTime = t; }catch(_){}
      }

      bgm.volume = 0.4;
      bgm.play().catch(()=>{});
    }

    resumeBgmSoft();
    window.addEventListener("pagehide", persistTime);

    function goNext(){
      persistTime();
      window.location.href = NEXT_PAGE;
    }

    function start(){
      const startAt = Date.now();
      const totalMs = DURATION_SEC * 1000;

      barFill.style.width = "0%";
      btnContinue.disabled = true;
      finished = false;

      if (tickId) clearInterval(tickId);

      tickId = setInterval(() => {
        const elapsed = Date.now() - startAt;
        const ratio = Math.min(1, elapsed / totalMs);
        barFill.style.width = Math.floor(ratio * 100) + "%";

        if (ratio >= 1){
          clearInterval(tickId);
          finished = true;
          btnContinue.disabled = false;
        }
      }, 100);
    }

    btnBack.addEventListener("click", () => {
      if (tickId) clearInterval(tickId);
      persistTime();
      window.location.href = BACK_PAGE;
    });

    btnContinue.addEventListener("click", () => {
      if (!finished) return;

      if (localStorage.getItem("bgmUnlocked") === "1"){
        bgm.volume = 0.4;
        bgm.play().catch(()=>{});
      }

      setTimeout(goNext, 120);
    });

    start();
  </script>
</body>
</html>
